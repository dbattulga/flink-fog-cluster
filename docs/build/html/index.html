

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Flink on a Fridge &mdash; Flink on Fridge 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'0.0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
          

          
            <a href="#" class="icon icon-home"> Flink on Fridge
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Flink on a Fridge</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deployment">Deployment</a><ul>
<li><a class="reference internal" href="#preparing-the-pi-cluster">Preparing the Pi cluster</a></li>
<li><a class="reference internal" href="#creating-docker-swarm">Creating Docker Swarm</a></li>
<li><a class="reference internal" href="#building-custom-flink-image">Building custom Flink image</a></li>
<li><a class="reference internal" href="#deploying-flink-image-on-a-cluster">Deploying Flink image on a Cluster</a></li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#help">Help</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Flink on Fridge</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>Flink on a Fridge</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="flink-on-a-fridge">
<h1>Flink on a Fridge<a class="headerlink" href="#flink-on-a-fridge" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this documentation is to explain the deployment of <a class="reference external" href="https://flink.apache.org/">Apache Flink</a> on a cluster of Raspberry Pis, which we simply call it the Fridge.
We used Docker Swarm to connect the Pis, and used Docker Stack to deploy the custom built Flink docker image for ARMv7 processor.</p>
</div>
</div>
<div class="section" id="deployment">
<h1>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h1>
<dl class="docutils">
<dt>First of all, the hardware:</dt>
<dd><ul class="first last simple">
<li>Few Raspberry Pi devices: we used 5 of Raspberry Pi 3b</li>
<li>Each Pi requires a micro SD card to run an OS</li>
<li>A network switch</li>
<li>A router</li>
<li>Power source</li>
<li>Network cables to connect everything together</li>
</ul>
</dd>
</dl>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/fridge.jpg"><img alt="The Fridge" src="_images/fridge.jpg" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">The Fridge constructed in INRIA, later used for the deployment of the Flink stack</span></p>
</div>
<div class="section" id="preparing-the-pi-cluster">
<h2>Preparing the Pi cluster<a class="headerlink" href="#preparing-the-pi-cluster" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Install the Operating System on SD cards</li>
</ol>
<p>Download the latest version of <a class="reference external" href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian Buster Lite</a> and burn the image on SD cards using <a class="reference external" href="https://www.balena.io/etcher/">Etcher</a> .</p>
<a class="reference internal image-reference" href="_images/etcher.png"><img alt="Etcher Screenshot" class="align-center" src="_images/etcher.png" style="width: 500px;" /></a>
<ol class="arabic simple" start="2">
<li>Enable SSH</li>
</ol>
<p>Create an empty file named <em>ssh</em> on the SD card to enable SSH.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$touch</span> /Volumes/boot/ssh
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Setup the Pis</li>
</ol>
<p>Plug the SD cards into Raspberries, SSH into it. Default host name would be <em>raspberrypi.local</em> and default password is <em>raspberry</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$ssh</span> pi@raspberrypi.local
</pre></div>
</div>
<p>Additionally you can use tools like <a class="reference external" href="https://angryip.org/">Angry IP scanner</a> to find out the correct host names of each Pis.</p>
<p>Set the hostname as you prefer by editing in:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$sudo</span> raspi-config
</pre></div>
</div>
<p>And set the static IP address by editing <em>/etc/dhcpcd.conf</em> file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$interface</span> eth0
<span class="nv">$static</span> <span class="nv">ip_address</span><span class="o">=</span> preferred IP
<span class="nv">$static</span> <span class="nv">routers</span><span class="o">=</span> router IP
<span class="nv">$static</span> <span class="nv">domain_name_servers</span><span class="o">=</span> preferred DNS, or you can <span class="nb">set</span> it as <span class="m">8</span>.8.8.8
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You might want to clean up some entries in <em>~/.ssh/known_hosts</em> file on your machine.</p>
</div>
<p>This process should be replicated on each Pis.</p>
</div>
<div class="section" id="creating-docker-swarm">
<h2>Creating Docker Swarm<a class="headerlink" href="#creating-docker-swarm" title="Permalink to this headline">¶</a></h2>
<p>Now we can move on to creating Docker Swarm on a Cluster.</p>
<ol class="arabic simple">
<li>Install Docker on each node:</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$curl</span> -fsSL https://get.docker.com <span class="p">|</span> sh
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Create Swarm and join nodes</li>
</ol>
<p>Initialize the Swarm cluster on one node using its IP. This node will act as a leader</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$sudo</span> docker swarm init --advertise-addr <span class="m">192</span>.168.0.104
</pre></div>
</div>
<p>The result will print the output, also you can run the following command to see the token for the Swarm.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$docker</span> swarm join-token worker
</pre></div>
</div>
<p>And copy the result on other nodes to join the Swarm</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$docker</span> swarm join --token SWMTKN-1-4y0h8i1aktttxxpuyk8844jk8rd1nt3k9oxdrfujg97z4va39d-0fnsq9ayei2s88xeuim7jdosz <span class="m">192</span>.168.1.104:2377
</pre></div>
</div>
<p>Check on the Leader node whether if the swarm is working</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$docker</span> node ls
</pre></div>
</div>
<p>If the swarm initialization was successful, it should look like this. Now we’re ready to deploy Flink.</p>
<a class="reference internal image-reference" href="_images/swarm.png"><img alt="Docker Swarm Screenshot" class="align-center" src="_images/swarm.png" style="width: 700px;" /></a>
</div>
<div class="section" id="building-custom-flink-image">
<h2>Building custom Flink image<a class="headerlink" href="#building-custom-flink-image" title="Permalink to this headline">¶</a></h2>
<p>Short story is there’s currently no native support for ARMv7 architecture for Flink Docker image.
Also, you’ll have to play with some Flink configurations in order to able to run it on Raspberry Pi.</p>
<ol class="arabic simple">
<li>Play with Flink configurations</li>
</ol>
<p>You can see all Apache Flink configurations <a class="reference external" href="https://ci.apache.org/projects/flink/flink-docs-stable/ops/config.html">here</a> and in <em>flink-conf.yaml</em> file, change the default
<em>jobmanager.heap.size</em> to <em>512m</em> and <em>taskmanager.heap.size</em> as <em>256m</em>. Those memory sizes were set considering the memory size of
Raspberry Pi device and number of task managers might be deployed in the future.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Additionally, you might want to change <em>TM_MAX_OFFHEAP_SIZE=”1G”</em> in <em>taskmanager.sh</em> file</p>
</div>
</div>
<div class="section" id="deploying-flink-image-on-a-cluster">
<h2>Deploying Flink image on a Cluster<a class="headerlink" href="#deploying-flink-image-on-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vel augue finibus, porta lorem in, congue metus.
Curabitur sodales mi sodales, fermentum nulla at, pellentesque urna. Nunc porta iaculis nibh vitae convallis.
Phasellus rhoncus ipsum vel nulla elementum, non egestas velit euismod</p>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vel augue finibus, porta lorem in, congue metus.
Curabitur sodales mi sodales, fermentum nulla at, pellentesque urna. Nunc porta iaculis nibh vitae convallis.
Phasellus rhoncus ipsum vel nulla elementum, non egestas velit euismod</p>
</div>
</div>
<div class="section" id="help">
<h1>Help<a class="headerlink" href="#help" title="Permalink to this headline">¶</a></h1>
<p>For more information, please contact: 9911thumb&amp;pinky</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Davaadorj Battulga

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>